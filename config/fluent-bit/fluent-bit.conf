[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020
    storage.type  memory
    storage.metrics on
    Parsers_File parsers.conf

# Прием логов через Forward протокол
[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24224
    Tag               app
    Mem_Buf_Limit     64MB

# Добавление метаданных
[FILTER]
    Name parser
    Match *
    Key_Name message
    Parser json
    Reserve_Data On
    Preserve_Key Off

# Вывод в OpenSearch
[OUTPUT]
    Name  opensearch
    Match app
    Host  opensearch
    Port  9200
    Index fluentbit
    Type  _doc
    tls   Off
    tls.verify Off
    Suppress_Type_Name On
    Logstash_Format On
    Logstash_Prefix fluentbit
    Logstash_DateFormat %Y.%m.%d
    Retry_Limit 5
    Buffer_Size 5MB

# (Опционально) Вывод в stdout для отладки
# Закомментировать после проверки работоспособности
[OUTPUT]
    Name  stdout
    Match app
    Format json_lines
